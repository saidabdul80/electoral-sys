import{l as S,m as B,o,c as a,a as h,b as e,F as g,p as x,u as _,k as u,t as c,j as f,n as p,h as V,v as j}from"./app.eaeff27d.js";/* empty css                                              */import{_ as z,a as E}from"./Sidenav.e4501f9e.js";import{_ as N}from"./Paginate.f6a899d1.js";import"./sweetalert2.b60c3fa0.js";import"./boostrap5.4b3a676c.js";const I={class:"height-100",id:"body-pd"},M=e("div",{class:"p-3 d-flex text-dark align-items-center"},[e("i",{class:"bi bi-stack"}),e("h4",{class:"ml-3 my-0"},"Chats")],-1),D={style:{height:"78vh","box-shadow":"2px 8px 27px -12px #888"},class:"chat-page row mx-auto w-100"},L={id:"chat-list",class:"position-relative px-0 col-md-3 bg-white",style:{height:"100%","overflow-y":"scroll"}},A=e("div",{class:"mt-3 px-3 mb-3 position-absolute bg-white w-100"},[e("input",{type:"text",class:"bg-light form-control w-10 rounded",placeholder:"Search or start new chat"})],-1),K=e("div",{style:{height:"75px"}},null,-1),O=["id","onClick"],R={key:0,class:"d-flex w-100 align-items-center user-x",style:{"user-select":"none"}},q=["src"],G={class:"py-3 pl-1 w-100",style:{"border-bottom":"1px solid #ccc",height:"100%","user-select":"none"}},H={class:"name"},J={class:"name"},P={class:"position-absolute",style:{bottom:"0px"}},Q={id:"chat-env",class:"col-md-9 p-0"},W={class:""},X={class:"wrapper position-relative"},Y={class:"chat-env-header bg-light"},Z={key:0,class:"d-block p-3"},ee={class:"main px-4",style:{height:"65vh","overflow-y":"scroll","overflow-x":"none"}},se={class:"px-2"},te={class:"pstyle pb-2 d-inline-block"},ie={key:0,style:{"font-size":"0.97em"},class:"mb-0"},ne={class:"mb-0"},oe=["src"],ae={key:1,class:"mb-0"},re=["href"],le=e("br",null,null,-1),ce=e("br",null,null,-1),de=e("br",null,null,-1),_e=e("br",null,null,-1),ue=e("br",null,null,-1),pe=e("br",null,null,-1),me=e("br",null,null,-1),he={key:0,style:{position:"absolute",left:"-4px",bottom:"-43px",width:"100%"},class:"px-4 navbar bg-light navbar-expand-sm d-flex justify-content-between"},ge={class:"d-flex justify-between w-100 align-items-center"},fe={id:"upload-photo-label",for:"upload-photo"},ve=e("div",{class:"icondiv d-flex justify-content-end align-content-center text-center ml-2"},[e("i",{class:"fa fa-paperclip icon1"}),f(),e("i",{class:"fa fa-arrow-circle-right icon2"})],-1),Ue={__name:"Chat",props:{canLogin:Boolean,canRegister:Boolean,laravelVersion:String,phpVersion:String,users:Array,currentUser:Object},setup(d){const l=d,t=S({loading:!1,conversations:[],conversation_with_id:0,is_typing:!1,clear_timeout:setTimeout(function(){},0)}),r=B({from_user_id:"",to_user_id:"",message:"",message_type:"",date:"..."});async function b(i,n){$(".user-x").parent().removeClass("activex"),$("#"+i+"user").addClass("activex"),t.loading=!0,t.is_typing=!1,t.conversation_with_id=i;let s=await axios.post("/fetch_conversation",{from_user_id:l.currentUser.id,to_user_id:i});t.conversations=s.data,t.loading=!1}function v(i){return l.currentUser.id===i?"float-right":"float-left"}function w(i){return l.currentUser.id===i.from_user_id?i.read?"float-right text-primary":"float-right text-secondary":"d-none"}function k(i){return l.currentUser.id===i?"bg_faint2 round1":"bg-white round2"}async function C(i){if(r.message!=""){let n=t.conversations.length;r.message_type="file",r.from_user_id=l.currentUser.id,r.to_user_id=t.conversation_with_id,r.date="...",t.conversations.push(r);let s=await axios.post("send_message",r,{headers:{"Content-Type":"multipart/form-data"}});t.conversations[n]=s.data}}async function y(i,n=!1){if(i.key==="Enter"||n==!0){let s=t.conversations.length,m=$("#textField").val();if(m!==""){let F={message:i.target.value,message_type:"text",from_user_id:l.currentUser.id,to_user_id:t.conversation_with_id,date:"..."};t.conversations.push(F),$("#textField").val("");let T=await axios.post("send_message",{message:m,message_type:"text",from_user_id:l.currentUser.id,to_user_id:t.conversation_with_id});t.conversations[s]=T.data}}clearTimeout(t.clear_timeout),t.clear_timeout=setTimeout(function(){axios.post("typing",{from_user_id:l.currentUser.id,to_user_id:t.conversation_with_id})},100)}window.Echo.private("chat").listen("MessageSent",i=>{t.conversation_with_id!=0&&i.user.id==t.conversation_with_id&&t.conversations.push(i.message)});function U(){setInterval(function(){t.is_typing=!1},5e3)}return window.Echo.private("chat-typing").listen("ChatTyping",i=>{i.user.id==t.conversation_with_id?t.is_typing||(t.is_typing=!0):t.is_typing=!1}),U(),(i,n)=>(o(),a(g,null,[h(z,{class:"bg-white text-dark"}),h(E,{active:"Chats"}),e("div",I,[M,e("div",D,[e("div",L,[A,K,(o(!0),a(g,null,x(d.users.data,s=>(o(),a("div",{id:s.id+"user",onClick:m=>b(s.id),key:s.id+"_c"},[s.id!==d.currentUser.id?(o(),a("div",R,[e("img",{src:"/photos/"+(s==null?void 0:s.image),width:"50",style:{"border-radius":"50px"},class:"img1"},null,8,q),e("div",G,[e("span",H,c(s.first_name)+" "+c(s.surname),1),f(" ("),e("span",J,c(s.email.slice(1,14)),1),f(") ")])])):u("",!0)],8,O))),128)),e("div",P,[h(N,{next:d.users.next_url_page,prev:d.users.prev_url_page},null,8,["next","prev"])])]),e("div",Q,[e("div",W,[e("div",X,[e("div",Y,[_(t).is_typing?(o(),a("span",Z,"typing ...")):u("",!0)]),e("div",ee,[e("div",se,[(o(!0),a(g,null,x(_(t).conversations,s=>(o(),a("div",{style:{clear:"both","margin-top":"4px"},key:s.id+"_ch"},[e("div",{class:p([v(s.from_user_id),"pt-2"])},[e("div",{class:p([k(s.from_user_id),"d-inline-block align-items-center pt shdowx"])},[e("div",te,[s.message_type=="text"?(o(),a("p",ie,c(s.message),1)):u("",!0),V(e("div",ne,[e("img",{src:"/uploads/"+s.message,style:{width:"35%"}},null,8,oe),e("p",null,c(s.message),1)],512),[[j,s.message_type=="image"]]),s.message_type=="file"?(o(),a("p",ae,[e("a",{href:s.message,target:"_blank"},c(s.message),9,re)])):u("",!0),e("span",{class:p([w(s),"bi-check2-all"]),style:{"font-size":"1em"}},null,2),e("span",{class:p(v(s.from_user_id)),style:{"font-size":"0.8em"}},c(s.date),3)])],2)],2)]))),128)),le,ce,de,_e,ue,pe,me])]),_(t).conversation_with_id!=0?(o(),a("nav",he,[e("div",ge,[e("input",{onInput:n[0]||(n[0]=s=>_(r).message=s.target.files[0]),type:"file",id:"upload-photo"},null,32),e("label",fe,"Browse "+c(_(r).message.name),1),e("input",{onKeyup:n[1]||(n[1]=s=>y(s)),id:"textField",type:"text number",name:"text",class:"form-control w-50",placeholder:"Type a message..."},null,32),e("button",{onClick:n[2]||(n[2]=s=>{C(),y(s,!0)}),class:"btn btn-sm btn-success"},"Send")]),ve])):u("",!0)])])])])])],64))}};export{Ue as default};
