import{l as j,y as z,o,c as a,a as f,b as e,h as p,v as h,u as d,F as v,m as w,k as u,t as c,j as y,n as m}from"./app.bb9e40a9.js";/* empty css                                              */import{_ as E,a as N}from"./Sidenav.46953f2c.js";import{_ as I}from"./Paginate.0dfd41c8.js";import"./sweetalert2.d240626d.js";const M={class:"height-100",id:"body-pd"},D=e("div",{class:"p-3 d-flex text-dark align-items-center"},[e("i",{class:"bi bi-stack"}),e("h4",{class:"ml-3 my-0"},"Chats")],-1),L={style:{height:"78vh","box-shadow":"2px 8px 27px -12px #888"},class:"chat-page row mx-auto w-100"},A={id:"chat-list",class:"position-relative px-0 col-md-3 bg-white",style:{height:"100%","overflow-y":"scroll"}},K=e("div",{class:"mt-3 px-3 mb-3 position-absolute bg-white w-100"},[e("input",{type:"text",class:"bg-light form-control w-10 rounded",placeholder:"Search or start new chat"})],-1),O=e("div",{style:{height:"75px"}},null,-1),R=["id","onClick"],q={key:0,class:"d-flex px-2 w-100 align-items-center user-x",style:{"user-select":"none"}},G=["src"],H={class:"bi bi-person-fill img1",style:{"font-size":"2.3em",background:"black",color:"white","border-radius":"50px",display:"flex"}},J={class:"py-3 pl-2 w-100",style:{"border-bottom":"1px solid #ccc",height:"100%","user-select":"none"}},P={class:"name"},Q={class:"name"},W={class:"position-absolute",style:{bottom:"0px"}},X={id:"chat-env",class:"col-md-9 p-0"},Y={class:""},Z={class:"wrapper position-relative"},ee={class:"chat-env-header bg-light"},te=e("i",{class:"bi bi-arrow-left text-dark"},null,-1),se=[te],ie={key:0,class:"d-block p-3"},ne={class:"main px-4",style:{height:"65vh","overflow-y":"scroll","overflow-x":"none","overflow-anchor":"none"}},oe={class:"px-2"},ae={class:"pstyle pb-2 d-inline-block"},le={key:0,style:{"font-size":"0.97em"},class:"mb-0"},re={class:"mb-0"},ce=["src"],de={key:1,class:"mb-0"},_e=["href"],ue=e("br",null,null,-1),pe=e("br",null,null,-1),he=e("br",null,null,-1),me=e("br",null,null,-1),ge=e("br",null,null,-1),fe=e("br",null,null,-1),ve=e("br",null,null,-1),ye={key:0,style:{position:"absolute",left:"-4px",bottom:"-43px",width:"100%"},class:"px-4 navbar bg-light navbar-expand-sm d-flex justify-content-between"},be={class:"d-flex justify-between w-100 align-items-center"},xe={id:"upload-photo-label",for:"upload-photo"},we=e("div",{class:"icondiv d-flex justify-content-end align-content-center text-center ml-2"},[e("i",{class:"fa fa-paperclip icon1"}),y(),e("i",{class:"fa fa-arrow-circle-right icon2"})],-1),Fe={__name:"Chat",props:{canLogin:Boolean,canRegister:Boolean,laravelVersion:String,phpVersion:String,users:Array,currentUser:Object},setup(_){const r=_,s=j({chatTab:!0,loading:!1,conversations:[],conversation_with_id:0,is_typing:!1,clear_timeout:setTimeout(function(){},0)}),l=z({from_user_id:"",to_user_id:"",message:"",message_type:"",date:"..."});async function k(i,n){$(".user-x").parent().removeClass("activex"),$("#"+i+"user").addClass("activex"),s.loading=!0,s.is_typing=!1,s.conversation_with_id=i;let t=await axios.post("/fetch_conversation",{from_user_id:r.currentUser.id,to_user_id:i});s.conversations=t.data,s.loading=!1}function b(i){return r.currentUser.id===i?"float-right":"float-left"}function C(i){return r.currentUser.id===i.from_user_id?i.read?"float-right text-primary":"float-right text-secondary":"d-none"}function U(i){return r.currentUser.id===i?"bg_faint2 round1":"bg-white round2"}async function T(i){if(l.message!=""){let n=s.conversations.length;l.message_type="file",l.from_user_id=r.currentUser.id,l.to_user_id=s.conversation_with_id,l.date="...",s.conversations.push(l);let t=await axios.post("send_message",l,{headers:{"Content-Type":"multipart/form-data"}});s.conversations[n]=t.data}}async function x(i,n=!1){if(i.key==="Enter"||n==!0){let t=s.conversations.length,g=$("#textField").val();if(g!==""){let B={message:i.target.value,message_type:"text",from_user_id:r.currentUser.id,to_user_id:s.conversation_with_id,date:"..."};s.conversations.push(B),$("#textField").val("");let V=await axios.post("send_message",{message:g,message_type:"text",from_user_id:r.currentUser.id,to_user_id:s.conversation_with_id});s.conversations[t]=V.data}}clearTimeout(s.clear_timeout),s.clear_timeout=setTimeout(function(){axios.post("typing",{from_user_id:r.currentUser.id,to_user_id:s.conversation_with_id})},100)}window.Echo.private("chat").listen("MessageSent",i=>{s.conversation_with_id!=0&&i.user.id==s.conversation_with_id&&s.conversations.push(i.message)});function F(){setInterval(function(){s.is_typing=!1},5e3)}window.Echo.private("chat-typing").listen("ChatTyping",i=>{i.user.id==s.conversation_with_id?s.is_typing||(s.is_typing=!0):s.is_typing=!1}),F();function S(){s.chatTab=!s.chatTab}return(i,n)=>(o(),a(v,null,[f(E,{class:"bg-white text-dark"}),f(N,{active:"Chats"}),e("div",M,[D,e("div",L,[p(e("div",A,[K,O,(o(!0),a(v,null,w(_.users.data,t=>(o(),a("div",{id:t.id+"user",onClick:g=>k(t.id),key:t.id+"_c"},[t.id!==_.currentUser.id?(o(),a("div",q,[p(e("span",null,[e("img",{src:"/photos/"+(t==null?void 0:t.image),width:"50",style:{"border-radius":"50px"},class:"img1"},null,8,G)],512),[[h,(t==null?void 0:t.image)==""]]),p(e("i",H,null,512),[[h,t.image!==""]]),e("div",J,[e("span",P,c(t.first_name)+" "+c(t.surname),1),y(" ("),e("span",Q,c(t.email.slice(1,14)),1),y(") ")])])):u("",!0)],8,R))),128)),e("div",W,[f(I,{next:_.users.next_url_page,prev:_.users.prev_url_page},null,8,["next","prev"])])],512),[[h,d(s).chatTab]]),e("div",X,[e("div",Y,[e("div",Z,[e("div",ee,[e("button",{onClick:n[0]||(n[0]=t=>S()),class:"shadow btn bg-white mt-2 ml-2 mr-2"},se),d(s).is_typing?(o(),a("span",ie,"typing ...")):u("",!0)]),e("div",ne,[e("div",oe,[(o(!0),a(v,null,w(d(s).conversations,t=>(o(),a("div",{style:{clear:"both","margin-top":"4px"},key:t.id+"_ch"},[e("div",{class:m([b(t.from_user_id),"pt-2"])},[e("div",{class:m([U(t.from_user_id),"d-inline-block align-items-center pt shdowx"])},[e("div",ae,[t.message_type=="text"?(o(),a("p",le,c(t.message),1)):u("",!0),p(e("div",re,[e("img",{src:"/uploads/"+t.message,style:{width:"100px"}},null,8,ce),e("p",null,c(t.message),1)],512),[[h,t.message_type=="image"]]),t.message_type=="file"?(o(),a("p",de,[e("a",{href:t.message,target:"_blank"},c(t.message),9,_e)])):u("",!0),e("span",{class:m([C(t),"bi-check2-all"]),style:{"font-size":"1em"}},null,2),e("span",{class:m(b(t.from_user_id)),style:{"font-size":"0.8em"}},c(t.date),3)])],2)],2)]))),128)),ue,pe,he,me,ge,fe,ve])]),d(s).conversation_with_id!=0?(o(),a("nav",ye,[e("div",be,[e("input",{onInput:n[1]||(n[1]=t=>d(l).message=t.target.files[0]),type:"file",id:"upload-photo"},null,32),e("label",xe,"Browse "+c(d(l).message.name),1),e("input",{onKeyup:n[2]||(n[2]=t=>x(t)),id:"textField",type:"text number",name:"text",class:"form-control w-50",placeholder:"Type a message..."},null,32),e("button",{onClick:n[3]||(n[3]=t=>{T(),x(t,!0)}),class:"btn btn-sm btn-success"},"Send")]),we])):u("",!0)])])])])])],64))}};export{Fe as default};
